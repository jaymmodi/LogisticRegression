package LogisticRegression;


import java.io.*;
import java.util.*;

public class ParseFile {

    public static void main(String[] args) {
        FileReader fr;
        BufferedReader br;

        try {
            fr = new FileReader(new File("logistic_input.txt"));
            br = new BufferedReader(fr);

            String trainingSetPath = br.readLine();
            String testSetPath = br.readLine();
            double learningRate = Double.parseDouble(br.readLine());
            boolean isCrossValidation = Boolean.parseBoolean(br.readLine());
            int folds = Integer.parseInt(br.readLine());

            br.close();

            Data data = new Data();
            CrossValidation crossValidation = new CrossValidation(trainingSetPath);

            List<Double> accuracyList = new ArrayList<Double>();

            for (int i = 0; i < folds; i++) {
                ArrayList<Example> examples = crossValidation.runCrossValidation(folds, data, i, isCrossValidation);

                LogisticTrain logisticTrain = new LogisticTrain(data.getNumberOfCols(), learningRate, data);

                for (String label : data.getDistinctLabels()) {
                    System.out.println("Building a model for " + label);
                    ArrayList<Example> trainingExamples = makeTrainData(examples, label, data);
                    logisticTrain.train(trainingExamples, label);
                }

                logisticTrain.printModels();

                if (isCrossValidation) {
                    double acc = logisticTrain.classify(crossValidation.foldTestList, new HashMap<String, ArrayList<Double>>());
                    accuracyList.add(acc);
                } else {
                    TestData testData = new TestData(testSetPath);
                    ArrayList<Example> testExamples = testData.testData();
                    double acc = logisticTrain.classify(testExamples, new HashMap<String, ArrayList<Double>>());
                    accuracyList.add(acc);
                }
            }

            printAllAccuracy(accuracyList);


        } catch (FileNotFoundException e1) {
            e1.printStackTrace();
        } catch (IOException e1) {
            e1.printStackTrace();
        }

    }

    private static void printAllAccuracy(List<Double> accuracyList) {
        double sum = 0;
        for (Double aDouble : accuracyList) {
            System.out.println(aDouble);
            sum = sum + aDouble;
        }
        System.out.println(sum / accuracyList.size());
    }

    private static HashMap<String, ArrayList<Double>> createMap() {
        HashMap<String, ArrayList<Double>> model = new HashMap<String, ArrayList<Double>>();

        model.put("Class_1", new ArrayList<Double>(Arrays.asList(-5.857472816507399, -7.249801478328294, -8.202781160769726, -4.65917055329646, 1.5287363784552137, 0.08939814535067726, 1.796833732203706, 1.4104178496475384, -15.70053080283029, -1.031489252199662, -24.359691634961376, 1.0233018577902633, -10.014996167752056, -13.306452071932602, -21.74855723489511, -2.304899915225956, 9.461558518435941, 1.258135055766119, -18.954106618336848, 1.46418678869369, -3.332507075308493, 1.6725584698216658, 8.98121482370637, 17.438593991836704, -14.989988291570961, -7.181091020221449, -5.924748866564463, -0.2507322410222323, -7.550838487914467, 8.875047084262764, -9.262694119654036, 8.531006656389577, -7.914126078068753, -37.266634093219785, -14.635323756605828, -8.398785454818695, 2.4838304232684774, -3.641144834686384, -8.314274313185674, -23.543696743536632, -9.676533446027374, -12.269220864309611, -36.3828152634406, 6.180047870908091, -5.599001296042971, -10.279457712646499, -11.544812517470513, -4.260530173138936, -1.1818113077947638, -20.384839801852664, -0.7651455648497968, -4.9868800218059, 5.3173274157627315, 1.4249703125271473, 2.6825018270553964, -15.71592598362027, -7.595665487691769, -32.167244455296526, -10.121872395632106, -9.145360510249972, 1.6625611820900164, 0.984124075625063, 1.0535446376110242, -10.418483573369924, -1.1454499318264473, 7.214186022299077, 5.014757226423046, -27.7968762336001, -18.196949607856737, 8.354117250528947, 2.393382147315839, -7.963461718141973, -14.10989019599781, -12.55216954604471, -23.269002881389536, 9.154444983742552, 6.937190269431719, -0.28274959083158213, 2.2677112567056366, -2.3071464193109077, 8.274345874808901, -9.35208738372386, -1.186403468862553, 14.85303999250022, -3.270616498157967, -14.466371980625865, -4.595329901570252, -4.467697316655895, -2.947292205222982, -26.9105263396938, -5.967181752445363, 0.28849507936455676, -13.151503316493905)));
        model.put("Class_2", new ArrayList<Double>(Arrays.asList(-0.2939277185726295, -10.017408274710666, -5.797534615914617, -0.4347834956263925, 2.0435361846347964, -0.0810893136186841, -6.955458573549345, -7.613253363763589, 0.8666814224740883, 0.39729326790513025, -13.259199195313997, 4.427902896326286, -12.377729593937019, 0.9466609931078235, 1.0313423261910326, 1.988599555002315, -16.97094746801634, 0.38652682258119786, -17.67200999687273, -4.262054984908341, 0.2829603913341581, -0.6085437168622733, -16.977517609151686, 6.944283307867523, 2.3602279127099886, -23.905473290856957, -14.110697768803204, -2.5767761591652025, -23.70141281128105, -15.623241465257145, -2.4503920328414823, -11.946052243597453, 4.5968247730053315, -16.62346093722659, -6.61031670239549, -28.41710816424406, -0.39581930058931386, 1.2917696614532215, -9.975102830792975, 1.1207426949263195, -12.691210724055027, -14.038303543079014, -0.6910305700509347, -0.07196079256732023, -2.295251043148028, -6.145982080010623, -16.732297518364, 6.658298155404695, -1.2609701867506629, -6.0768132534306, -9.280891454702802, -0.4161929945602249, -10.904170886158884, 2.5695665877384672, -2.8585619275891716, -9.068536915960317, -16.594280657928252, -16.204275589441988, -25.790124857445573, -11.83257257104229, -9.514327663867292, -1.1096368828100531, 6.0336997623464335, 3.3525153157931378, 3.540101218393121, 2.3905606790658056, 1.6774142332296131, -41.25701346566674, -7.448216852237794, -0.05220335549372788, -11.586051540770812, 1.6392858439709408, -10.667161508332894, 3.2915686730219003, -30.35034652452313, -9.726101796849335, 8.459447241158122, -19.209665950357344, -5.4727132748398795, -6.1867064265537905, -5.060215323617169, 0.7543273023576884, -3.741121907413667, -9.863116471884894, -0.7558435029046725, 0.23619627367526266, 2.799063524832515, -1.4321205066552485, 1.2410371176385095, -22.566700525098675, -15.450520181955863, 0.9796675809564177, -2.203646791706765)));
        model.put("Class_3", new ArrayList<Double>(Arrays.asList(-5.4853274862625065, -4.723805343682346, -5.4817312885980245, -1.8580689628344897, -4.724261291782849, -1.2896199347217923, -12.544513352508128, -9.213673635197523, 1.1787121503057476, -1.6017983930511073, -13.89527543885678, -0.04497789529890412, -0.8486271534392712, -0.20063152559926611, -0.8499629959911773, 3.1809448341782853, -14.191897095170557, -2.190914087235127, -8.814235752180867, -2.9765057352910826, 1.0390974272128304, -0.5311058266874098, 0.3314582530369353, 0.44811243018699115, -2.4128798011587342, -24.52648021273368, -4.285158486995424, -3.7467524879853977, -0.04963510854194426, 1.1625045917270347, -1.5481120503604435, 12.442847564867828, -2.2230485358919343, -20.419024423228816, -4.705306058086674, -9.73508218049397, -1.9513908016209554, 3.1027894186645666, -7.779503212733481, 1.1520473503096476, -1.1705970454184733, -9.879725330834637, 7.137957035688491, 0.25136114692433204, -5.675925314147984, -2.2356076082456804, -23.788212174413555, -3.1027017018485794, -0.1615721350576348, 0.9421367985536161, -6.748432990163641, -3.786640997223026, -3.97193153550039, 0.850269800622533, -0.3146071496276077, 0.2812416540889248, -17.610441984527398, -11.259085338402127, -17.461045416029275, -33.89474850382673, -7.793081012667007, -0.060655897618563964, 2.6134783978715386, 3.6152334025343302, -4.8560599850473025, -1.3981310313710706, -12.354869092712258, -17.66943205588363, -21.89243951509358, 2.9729053245746666, 0.7818059131501428, -1.1250974937513278, -14.08375950409541, -18.39715866791029, -23.8034319889408, -21.63432968358772, -11.467588366712507, -6.528415009002922, -1.5723757628607706, 3.369558683781076, -4.0832209105134085, -8.71980018092452, 9.529894602166076, -6.169186720527557, 1.186070835676746, 1.0590867697830146, -7.603389822173525, 0.31982666408483346, 10.55605507716622, -18.22839965174424, -15.125373068989312, -15.47008799755036, -9.555592084061228)));
        model.put("Class_4", new ArrayList<Double>(Arrays.asList(12.035783606916356, -13.304964809048831, -14.724803994136591, -18.03128917644815, -0.7295944129111555, -1.6340084099678416, -16.867030025659012, -5.751322990835871, -21.881102045131254, 1.3660887086762703, -24.52384948958039, -8.647530962694583, -0.2558719661017589, -2.592535529231081, 1.3422631951299124, 3.1616908920574747, -25.0027891742566, -9.031619479310885, -7.360683804294967, 1.1120550565272793, -2.5666543166389943, 0.7146118811699856, -4.4107899380898274, -51.22272390008677, 0.3009779216780917, 13.310440494782604, -6.285733355526298, -10.394254842087255, -11.288353166722802, -8.316427203321998, -8.555790019159963, -11.013081735333746, -2.7287532771826553, -27.959631272839133, -20.659946748291784, -6.1998587344479175, 0.09052945401978249, -2.330808750440586, -17.887934486183774, -3.105609351692089, -2.927305037058698, 0.7176801188473584, -0.3929311451511679, 3.871141252412206, -6.70787952487981, -11.26749560117239, -28.102414907255746, -10.451770064703139, -10.87450999468204, -9.14840754706839, -8.477729139715317, 2.4373775677396425, -0.7394507900518613, -2.742959958615706, -1.135268983406307, -1.2731390671343181, -21.591625736875073, -17.21894940975797, -23.807124910817585, -5.614475719415776, -14.70792682388814, -17.144315185031772, 7.996176915869687, -3.1710686752984354, -8.370913106598982, -3.22654174448429, -38.26084968389336, -20.235391346047987, -11.527100472763646, 2.064080439598078, -14.630278424286042, -1.7027693755699196, -11.522659338541526, 0.0018286198455612513, -21.120356189850046, -30.969672815257816, -12.482468325240939, -11.60014771222666, 0.9808287128359349, -5.5196021959566295, -12.067532761940122, -10.147545962095164, -13.578232671951566, -7.397090558527762, 0.5363495650085286, -2.1076245740451123, 15.212784548897858, 0.18627381156862904, -2.3553517445779444, -17.32645050662099, -8.415096002744416, 1.0575025180998885, -15.798091422151565)));
        model.put("Class_5", new ArrayList<Double>(Arrays.asList(-4.570786821043253, -2.402868363372639, -3.0429355685240935, -3.204286706537623, -2.7002247321806396, -3.2013351973588415, -5.247222195889929, -9.742048687592778, -6.588435046281749, -6.108093587102652, -22.745507322728816, 0.682499893467198, 2.22715299223622, -15.908677627998207, -14.040545933562713, -5.231848381615393, -10.016510380050654, -4.502007849382002, -6.473488040514321, -8.526657295581197, -3.9780769708656076, -1.9906312875718255, -2.2744083600444154, -9.0487497866674, -23.81623438316188, -9.399188477028412, -2.54211256409054, -2.3178914561441846, -2.567268880622501, -2.6619791049405035, -1.457019627908175, -4.012005125929291, 4.062836380094386, 40.45444674765692, -2.587966896582547, -9.334666469141446, -10.281529450471016, -7.249720952370545, -8.703626969503839, -7.366343572744945, -6.426311296874192, -9.058722616041065, -13.54021295553829, -5.098959523510819, -1.9837228269858171, -4.771360789681581, -7.834387409616694, -12.57967643677748, -1.70443062829173, -3.772475805007257, -1.9985523933082625, -3.3638478675013372, -3.3569744353448256, -5.209424584957336, -6.998146094019089, -6.568408772750585, -7.00424560856408, -4.027004189193505, -2.837610964257242, -14.493635050635788, -2.8544829264895433, -7.708537303393436, -1.8804949473440262, -6.41179057944375, -2.9962446728557217, -7.825888001690888, -20.80675895412499, -8.076683109879516, -9.161458618043836, -8.047176296926764, -3.207923178794871, -13.898368026621531, -3.209247565770133, -2.101080847238226, -18.091174383555757, -7.65959922214531, -3.6299161005591865, -4.500540946255716, -6.937009701932415, -4.914489834622092, -3.239892617143324, -2.794000645905542, -11.21152053355874, -1.3905868371531303, -7.941549538329618, -18.156847924180106, -3.3913228312452444, -13.916580993816401, -2.742603277422113, -4.013088403634245, -5.295230253461011, -0.3889283798030105, -1.0956373852427224)));
        model.put("Class_6", new ArrayList<Double>(Arrays.asList(6.602478856375232, 0.17856161428306666, 1.831237410711198, -0.3202112356189598, -9.175975441119032, 0.5951116183711521, -7.409033420969105, -10.895644081592367, -10.363993361964132, -3.315623445957094, 24.334148718820988, -2.721356798281181, 1.8631088939688754, -12.476885091060744, -15.215921271110679, 1.416437629983124, 0.6120911616833326, 3.1997230221911472, -14.075258770311864, -0.9237611314021679, 0.10768131397094725, 0.8895281847358526, 4.187221609748788, -4.360538615052599, -10.893680697375352, 9.650465176918576, 3.6088527004182738, -0.0066085154818932255, 6.664522668202781, -13.327203052542341, 4.0842829156492835, -8.188888299363622, -3.453162969731649, -34.33008590638662, -24.866252584286944, -11.173416436632037, -4.1284605576230575, -4.749629334933378, -0.8343680663365248, -15.428709665530187, -4.230936125410294, 16.578074261909403, -6.845033694701964, 5.483157525111618, 4.0156941097643015, 2.615086383732874, 0.41626643649393086, -9.045672366900861, 1.2593609018088383, 3.1102200893088154, -0.12175983310927085, -5.056794525912714, -2.1491144404236606, 1.2476286937793986, 1.0966043816562312, -9.914964161805102, 15.38786593062099, -13.120535223961923, 3.5678422938986762, 14.983768589598954, 12.364832587365152, -12.427543742760957, 1.510882280008949, 7.073215013199233, -3.6460351281121106, -0.6150260755121364, -3.4798056914287256, -19.630035950257234, -8.4139233467357, -1.6953554515621885, -6.307348555223196, -9.219001786321984, -7.987328803785116, 8.119280285328596, -13.053651361858229, -13.756666758503261, -4.587444636217605, -19.035355268644363, 2.297244630949711, -0.21200479601458247, -1.4977443347569466, 4.3804862957342054, -2.1698771898769005, -11.092507200820105, -5.284765844074545, -6.954448576774544, 11.949178458685878, -9.684279784567435, -6.620983723511699, -18.715189483178456, -1.8772867800051327, 0.0790060366094084, 17.863095499223945)));
        model.put("Class_7", new ArrayList<Double>(Arrays.asList(0.6684022889821445, 3.8532051284994693, -3.434212840939187, -4.004317301630342, -6.9892738785094695, -1.131433088479017, 0.36466639214981017, -20.562170903554403, -14.692155227541015, 0.3030689227345107, -15.914676478240036, 4.894204660892084, -10.352828879133718, -7.808154336830272, -21.509136929429623, 4.775385877082567, 4.586979505394201, -1.155630582472509, -13.820527832581172, -0.30295324736940415, -1.3617105676070917, -1.6067907216505055, 20.114158598578726, -0.40008573936204245, -11.492144892289698, -11.123588213402774, -10.868684454106237, -3.8195703748331975, -4.8189156732830645, -7.57890671034617, -3.3130647504481723, 33.06892142873183, -4.294003514446977, -32.24001498110509, -6.866065725762776, -19.619434253805448, 1.5889733950805216, 6.4931010966162805, 16.763351220056705, -17.420852788592025, -8.55843780677699, -9.239785993577325, 0.11052980391386992, 2.51643239834533, 14.765265421514904, -9.854913894071656, 0.43546727993175405, -1.426374550981809, 9.829474031204663, 20.848893962984206, -0.41508771939477357, 0.6884498191922054, -9.159326700033942, -4.950650525053105, 0.41286013232660157, 6.2016873509852255, -3.4833653080255047, -13.508231363227434, -9.045173368897496, -6.319888480121004, -7.408601113470836, -15.84349628320267, 3.750640191204452, 1.6640822776819613, -1.0573874794543683, 4.478029059612782, -7.573204715096927, -22.896430693696296, -12.814667897359596, 4.602199587184841, -2.1315912932910868, -6.239402555902621, -10.410985623751294, -4.771053098856186, -31.309216570809937, -6.231642361653455, -3.6690331116123875, -9.080995672160867, 1.372143359059012, 0.41352950786601433, 4.490724887051209, -3.275479306472257, 3.5858688582657243, -8.660529680698538, -5.117393145350745, 5.703894729871182, 2.3032352609127353, -3.8403129246524266, 3.3202208805779687, -17.81998780629129, -3.667609508453954, -7.869055739897424, -6.873718567334709)));
        model.put("Class_8", new ArrayList<Double>(Arrays.asList(2.7798027193047483, -1.520441858669214, -4.807061438333635, 2.628408448027851, 0.19459958200617797, -1.0621454935916377, 4.56184653517576, -9.983378398531963, -3.7526839414572772, 2.3421222853417216, -20.940868825815325, 0.9073346439524322, 3.154655860433438, -12.523736811100378, -19.176002512227075, -1.602099373148688, -5.811898854048656, 0.17862486295215535, 14.46077128392071, 5.072189151529291, 0.47135747555687685, 0.6463769424550251, -2.289261550563034, 0.7644902663882095, -8.058138600853791, -8.079928301678711, -3.407512537469798, 3.4334759208488173, -3.4650264413013803, -1.6328323546440993, 6.232610972901403, -6.348498996064717, -0.5557952868109888, -26.179881106761393, 21.420475622868683, -10.98371072115982, 5.299392013923743, 9.063465649917081, -14.809157578128694, -14.940122632714559, 1.467443572461575, -9.689029207963966, -17.159555217873482, -1.1244868577029425, -4.823175604653281, -0.7131588660319765, 9.447249611495089, -11.465000017978728, -2.5687900392595475, -8.133746600883066, 1.0199050807535, 2.7948544720710737, -6.068860016348322, 0.924106111124651, -1.2433495226041669, -7.968787290177208, -6.4180705448215125, 16.918847885931076, -6.6203000854655984, -13.051824237583121, -4.061689703376628, -1.9549225100788559, -2.7753573623596774, 1.2334471177068012, 2.860121827929316, 1.7032229912692842, -2.715213861171097, 32.41451853062934, 18.8106278769031, -1.005927796400201, 6.437159455544159, -9.620660209919935, 9.15067379770717, 1.5115764344111626, 20.301607549588553, 5.797217886973676, -6.604195895763877, 10.928727789134706, -5.917903523638886, 2.8776462945622203, 3.186437082501851, -1.6393932298413834, 0.8588957235465294, 1.8495992001451316, -7.883075311589651, -22.161858716168027, -8.142993641356078, -10.451695337608317, 7.293723655597911, 20.468155232854276, -12.53648167539891, -2.168566852964035, -2.429905655292669)));
        model.put("Class_9", new ArrayList<Double>(Arrays.asList(6.608152769116006, -10.16895808077025, -5.2179237304961195, -8.133556509742338, -5.6732009960333185, -8.917599272096881, -8.036199076865136, 2.8428521349376403, -15.62398625865204, -4.654645100095489, -21.89940791279145, -6.498260633006341, 9.37859362445664, -11.599272131514777, -16.40275534604298, 1.4761201510417439, 3.2409771752578287, 1.642021472945588, -13.529753385794983, -1.4882143661766336, 2.1371386782504667, 5.746758943671378, -13.387032720355746, -21.407409366783934, -5.295834512914914, -6.1508921041639875, -6.187377701064818, 1.0627205022095554, -0.9854951923182984, 17.99768941279611, -2.4604290038190695, -2.972950894870521, -0.8195960606669738, -41.4601428526085, -9.772320458681278, 20.454132980252986, -8.880708949661829, -8.063201718222556, -18.8172569212232, -23.164366056839924, 11.024994083977656, -11.611248249142793, -26.63334465972965, -0.5978866959812273, -12.310858894514732, -13.828833717463974, -20.68948031708271, -2.699627639283793, -4.822443829893483, -13.245630985762126, -3.3178234498654198, -1.3128722238320953, 8.938133840764767, -4.037433247315777, -5.0158231901272154, -2.658476494376293, -10.951792049382078, -15.18026978420877, 36.56376366038907, -12.363682641906156, -8.435626823041275, 19.24036021980939, -2.582701622559422, -18.862762280399608, -3.010657871849372, 2.863781400238685, 2.662679345220498, -18.902351736803187, -18.744220387899723, -3.968858546029343, -6.9640500368111, -9.69028173614688, -22.489228186356737, 7.274927730013333, -11.474381068932393, -4.293512277213932, 7.096852177569592, -10.433880433708206, 0.7877719140559679, -3.8108244448460535, -7.159047613590104, 4.369509503344604, 2.701271053623028, -20.3698144659033, -9.363186030132814, -17.130669306346775, 3.920630491642767, -15.655536121343866, 10.703817104394112, -20.11194114737233, 11.372423593621441, 3.082749511252854, -11.659196706220813)));

        return model;
    }

    private static ArrayList<Example> makeTrainData(ArrayList<Example> dataSet, String label, Data data) {

        for (Example example : dataSet) {
            if (example.getActualLabel().equals(label)) {
                example.setLabel(1);
            } else {
                example.setLabel(0);
            }
        }
        return dataSet;
    }

    private static void findDistinctValuesInCols(Data data, ArrayList<Example> dataSet) {

        Set<Double> uniQueValues = new HashSet<Double>();
        for (int i = 0; i < data.getNumberOfCols(); i++) {

            for (Example example : dataSet) {
                double value = example.getValues()[i];
                uniQueValues.add(value);
            }
            data.getDistinctValuesPerColumn()[i] = uniQueValues.size();
            uniQueValues.clear();
        }
    }
//
//    public static ArrayList<Example> parseFile(String fileName, Data data) throws IOException {
//
//        BufferedReader br = new BufferedReader(new FileReader(fileName));
//        String line;
//        int index = 1;
//        ArrayList<Example> examples = new ArrayList<Example>();
//        Set<String> distinctLabels = new HashSet<String>();
//
//        setDataSpecificInformation(data, br);
//
//        while ((line = br.readLine()) != null) {
//            String perLine[] = line.split(",");
//
//            Example trainingExample = new Example();
//            trainingExample.setIndex(index);
//
//            double[] values = new double[perLine.length - 1];
//
//            for (int i = 0; i < perLine.length; i++) {
//                if (i == perLine.length - 1) {
//                    trainingExample.setActualLabel(perLine[i]);
//                    distinctLabels.add(perLine[i]);
//                } else {
//                    values[i] = Double.parseDouble(perLine[i]);
//                }
//            }
//
//            index++;
//            trainingExample.setValues(values);
//            examples.add(trainingExample);
//        }
//        br.close();
//        data.setNumberOfClassLabels(distinctLabels.size());
//        data.setDistinctLabels(distinctLabels);
//        return examples;
//    }
//
//    private static void setDataSpecificInformation(Data data, BufferedReader br) {
//        String line;
//        try {
//            line = br.readLine();
//            String[] perLine = line.split(",");
//
//            data.setNumberOfCols(perLine.length - 1);
//
//            String[] colNames = new String[perLine.length - 1];
//            for (int i = 0; i < perLine.length - 1; i++) {
//                colNames[i] = perLine[i];
//            }
//            data.setNamesOfColumns(colNames);
//
//        } catch (IOException e) {
//            e.printStackTrace();
//        }
//    }

}
